---
title: "Portfolio 1"
author: "Thomaas Huang"
output: github_document
---

This portfolio aims to practice my skills of data wrangling. Specifically, I will import Mplus .out files and present them in a more straightforward fashion. I choose to do this because (a) it is very confusing to find the right information in Mplus and (b) I need present some modeling for my SPSP poster. 

```{r load-packages, warning = FALSE, message=FALSE}
library(tidyverse) 
library(tidyr)
library(MplusAutomation)
```

# Import Mplus .out file

```{r import-file}
model_results <- readModels("model2_r.out")
names(model_results)
```

# Model fit information

```{r model-fit}
model_fit <- model_results["summaries"] %>% 
  as.data.frame() %>% 
  rename_all(~stringr::str_replace(.,"summaries.","")) %>% 
  dplyr::select(RMSEA_Estimate, SRMR, ChiSqM_Value, ChiSqM_DF, ChiSqM_PValue, CFI, TLI, AIC, BIC, aBIC)

model_fit
```
# Undstandardized coefficients
## Factor loadings

```{r unstd-loadings}
unstd_loadings <- model_results[["parameters"]][["unstandardized"]] %>% 
  as.data.frame() %>% 
  filter(str_detect(paramHeader, "\\.BY$"))

unstd_loadings
```

## Regression coefficients

```{r unstd-reg}
unstd_reg <- model_results[["parameters"]][["unstandardized"]] %>% 
  as.data.frame() %>% 
  filter(str_detect(paramHeader, "\\.ON$"))

unstd_reg
```

## Correlation among predictors and mediators

```{r unstd-corr}
unstd_corr <- model_results[["parameters"]][["unstandardized"]] %>% 
  as.data.frame() %>% 
  filter(str_detect(paramHeader, "\\.WITH$"))

unstd_corr
```

## Intercepts

```{r unstd-intcpt}
unstd_intcpt <- model_results[["parameters"]][["unstandardized"]] %>% 
  as.data.frame() %>% 
  filter(str_detect(paramHeader, "\\Intercepts$"))

unstd_intcpt
```

## Residual variances

```{r unstd-residual}
unstd_residual <- model_results[["parameters"]][["unstandardized"]] %>% 
  as.data.frame() %>% 
  filter(str_detect(paramHeader, "Residual.Variances$"))

unstd_residual
```

## Indirect effects

This chunk of codes extracts 95% CI of indirect effects estimated by bootstrapped samples
```{r unstd-ind}
unstd_ind <- model_results[["indirect"]][["ci.unstandardized"]][["specific"]] %>% 
  as.data.frame() %>% 
  dplyr::select(pred, intervening, outcome, low2.5, est, up2.5)

unstd_ind
```

# Standardized coefficients
## Factor loadings

```{r std-loadings}
std_loadings <- model_results[["parameters"]][["stdyx.standardized"]] %>% 
  as.data.frame() %>% 
  filter(str_detect(paramHeader, "\\.BY$"))

std_loadings
```

## Regression coefficients

```{r std-reg}
std_reg <- model_results[["parameters"]][["stdyx.standardized"]] %>% 
  as.data.frame() %>% 
  filter(str_detect(paramHeader, "\\.ON$"))

std_reg
```

## Correlation among predictors and mediators

```{r std-corr}
std_corr <- model_results[["parameters"]][["stdyx.standardized"]] %>% 
  as.data.frame() %>% 
  filter(str_detect(paramHeader, "\\.WITH$"))

std_corr
```

## Intercepts

Note: There are only standardized intercepts for measurement models. There is no standardized intercept for regression coefficient.
```{r std-intcpt}
std_intcpt <- model_results[["parameters"]][["stdyx.standardized"]] %>% 
  as.data.frame() %>% 
  filter(str_detect(paramHeader, "\\Intercepts$"))

std_intcpt
```

## Residual variances

```{r std-residual}
std_residual <- model_results[["parameters"]][["stdyx.standardized"]] %>% 
  as.data.frame() %>% 
  filter(str_detect(paramHeader, "Residual.Variances$"))

std_residual
```

## Indirect effects

```{r std-ind}
std_ind <- model_results[["indirect"]][["ci.stdyx.standardized"]][["specific"]] %>% 
  as.data.frame() %>% 
  dplyr::select(pred, intervening, outcome, low2.5, est, up2.5)

std_ind
```




